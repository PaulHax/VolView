<script lang="ts">
import { computed, defineComponent } from '@vue/composition-api';
import { useView3DStore, CVRConfig } from '../store/views-3D';

export default defineComponent({
  name: 'VolumeRendering',
  setup() {
    const view3DStore = useView3DStore();

    // --- CVR --- //

    const cvrParams = computed(() => view3DStore.cvrConfig);
    const setCVREnabled = (enabled: boolean) => {
      view3DStore.updateCVRParameters({
        enabled,
      });
    };
    const setCVRParam = (key: keyof CVRConfig, value: any) => {
      view3DStore.updateCVRParameters({
        [key]: value,
      });
    };

    const enabled = computed(() => cvrParams.value.enabled);
    const laoEnabled = computed(() => cvrParams.value.useLocalAmbientOcclusion);
    const vsbEnabled = computed(
      () => cvrParams.value.useVolumetricScatteringBlending
    );

    return {
      cvrParams,
      enabled,
      laoEnabled,
      vsbEnabled,
      setCVREnabled,
      setCVRParam,
    };
  },
});
</script>

<template>
  <div class="mx-2">
    <div class="mt-4" ref="editorContainerRef">
      <div ref="pwfEditorRef" />
    </div>
    <div>
      <v-switch
        label="Enable Cinematic Volume Rendering"
        dense
        hide-details
        :value="enabled"
        @change="setCVREnabled"
      />
      <v-divider class="my-4" />
      <v-switch
        label="Enable Volumetric Scattering"
        dense
        :disabled="!enabled || laoEnabled"
        :value="vsbEnabled"
        @change="setCVRParam('useVolumetricScatteringBlending', $event)"
      />
      <v-slider
        label="Blending"
        min="0"
        max="1"
        step="0.05"
        dense
        hide-details
        thumb-label
        :disabled="!enabled || !vsbEnabled"
        :value="cvrParams.volumetricScatteringBlending"
        @input="setCVRParam('volumetricScatteringBlending', $event)"
      />
      <v-switch
        label="Enable Local Ambient Occlusion"
        dense
        :disabled="!enabled || vsbEnabled"
        :value="laoEnabled"
        @change="setCVRParam('useLocalAmbientOcclusion', $event)"
      />
      <v-slider
        label="LAO Kernel Size"
        min="5"
        max="32"
        step="1"
        dense
        hide-details
        thumb-label
        :disabled="!enabled || !laoEnabled"
        :value="cvrParams.laoKernelSize"
        @input="setCVRParam('laoKernelSize', $event)"
      />
      <v-slider
        label="LAO Kernel Radius"
        min="1"
        max="15"
        step="1"
        dense
        hide-details
        thumb-label
        :disabled="!enabled || !laoEnabled"
        :value="cvrParams.laoKernelRadius"
        @input="setCVRParam('laoKernelRadius', $event)"
      />
      <v-slider
        label="Ambient"
        min="0"
        max="1"
        step="0.1"
        dense
        hide-details
        thumb-label
        :disabled="!enabled"
        :value="cvrParams.ambient"
        @input="setCVRParam('ambient', $event)"
      />
      <v-slider
        label="Diffuse"
        min="0"
        max="2"
        step="0.1"
        dense
        hide-details
        thumb-label
        :disabled="!enabled"
        :value="cvrParams.diffuse"
        @input="setCVRParam('diffuse', $event)"
      />
    </div>
  </div>
</template>
